---
layout: post
title: AWS
date: 2017-04-06 18:01:36 +0300
access: public
categories: [AWS]
---

<!-- more -->

* TOC
{:toc}

think of some name that you would use throughout all the services that
identifies your project - say, foo.<br>
then name Amazon resources as follows:

- bucket: foo.bucket
- policy: foo.policy
- user: foo.user

## account (aka AWS account)

create Amazon account if you don't have one
(this is a single account for all Amazon services including shop itself).

### account identifiers

<http://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html>

each AWS account is assigned 2 unique IDs:

- AWS account ID (used to construct ARNs)
- canonical user ID (used for cross-account access to S3 bucket)

later these IDs can be found as follows (from any service):

`<your_name>` (menu in top right corner) ->
  `My Security Credentials` -> `Accound Identifiers`

### generate access keys

these keys (just like the keys of any service created in IAM service) can be
used to make programmatic requests to AWS services (say, to S3 service).

`<your_name>` (menu in top right corner) ->
  `My Security Credentials` ->
  `Access Keys (Access Key ID and Secret Access Key)` ->
  `Create New Access Key` (button)

NOTE: save generated credentials (`Access Key ID` and `Secret Access key`) -
      secret access key won't be available later (just like in IAM service).

## [S3](https://console.aws.amazon.com/s3/home?region=us-west-2)

### access bucket

<http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingBucket.html>

- virtual-hosted-style URL:

  - `http://foo.bucket.s3.eu-central-1.amazonaws.com`
  - `http://foo.bucket.s3-eu-central-1.amazonaws.com`

- path-style URL:

  - `http://s3.eu-central-1.amazonaws.com/foo.bucket`
  - `http://s3-eu-central-1.amazonaws.com/foo.bucket`

both ways are equivalent except that when using virtual-hosted-style URLs:

- it's possible to omit region name (`http://foo.bucket.s3.amazonaws.com`) -
  request will be routed to appropriate region where bucket resides
- bucket name must be DNS-compliant

### create bucket

> 1) Name and region

- Bucket name: foo.bucket (must be unique across all buckets names in S3)
- Region: EU (Frankfurt)

> 2) Set properties

leave default settings (`Versioning` and `Logging` are disabled).

> 3) Set permissions

give `Read` permissions to `Everyone` (for `Objects` only).

users and their permissions can be managed after bucket creation
(`Permissions` (tab) -> `Access Control List` (button)).

### add policy to bucket to allow public read

- select bucket (foo.bucket)
- `Permissions` (tab) -> `Bucket Policy` (button)
- paste policy (specify actual bucket ARN) and save it

## [IAM](https://console.aws.amazon.com/iam/home?region=us-west-2)

### create policy

`Policies` (left sidebar) -> `Create policy` (button)

> 1) Step 1: Create Policy

select `Create Your Own Policy`

> 2) Step 2: Set permissions

omitted when creating your own policy.

> 3) Step 3: Review Policy

- Policy Name: foo.policy
- Policy Document: policy itself (specify actual bucket ARN)

### create user

`Users` (left sidebar) -> `Add user` (button)

> 1) Details

- User name: foo.user
- Access type: [x] Programmatic access

> 2) Permissions

- select `Attach existing policies directly`
- find and check foo.policy

> 3) Review

> 4) Complete

NOTE: save generated credentials (`Access Key ID` and `Secret Access key`) -
      secret access key won't be available later.

## awscli

- install `awscli`

  ```sh
  $ brew install awscli
  ```

- configure `aws`

  select the same [region](http://docs.aws.amazon.com/general/latest/gr/rande.html)
  as for S3 bucket.

  ```sh
  $ aws configure
  AWS Access Key ID: ***
  AWS Secret Access Key: ***
  Default region name: eu-central-1
  Default output format: None
  ```

- test copying to S3 bucket

  ```sh
  $ aws s3 cp test.txt s3://foo.bucket/
  upload: ./test.txt to s3://foo.bucket/test.txt
  $ aws s3 ls s3://foo.bucket/
  2017-04-07 03:14:59          4 test.txt
  $ aws s3 rm s3://foo.bucket/test.txt
  delete: s3://foo.bucket/test.txt
  ```
