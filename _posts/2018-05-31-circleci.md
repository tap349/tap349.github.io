---
layout: post
title: CircleCI
date: 2018-05-31 19:28:15 +0300
access: private
comments: true
categories: [circleci]
---

<!-- more -->

* TOC
{:toc}
<hr>

troubleshooting
---------------

### build is not starting after changes are pushed to Github

**solution**

there was an error in my CircleCI config - `version: 2` key was missing in
`workflows` section.

to find specific error open current branch of your project in CircleCI -
you'll see a big yellow `NEED SETUP` button in case there are any errors
in your config.

### /bin/bash: yarn: command not found

**solution**

pre-built CircleCI Docker image `circleci/ruby:2.5.1` doesn't have
Yarn preinstalled - use `-node` image variant instead:

> <https://circleci.com/docs/2.0/yarn/#using-yarn-in-circleci>
>
> If you are using one of the other language images such as circleci/python
> or circleci/ruby, there are two image variants that will include Yarn as
> well as NodeJS. These would be the -node and -node-browsers image variants.

### Rails.application.credentials are empty in Rails 5.2+

**solution**

1. <https://stackoverflow.com/questions/48935168/handle-credentials-in-circleci-rails-app>

Rails 5.2 uses encrypted _config/credentials.yml.enc_ to store credentials and
_config/master.key_ to decrypt it but the latter is not available on CircleCI.

it's possible to store master key in `RAILS_MASTER_KEY` environment variable:

> <http://guides.rubyonrails.org/5_1_release_notes.html#encrypted-secrets>
>
> Secrets will be decrypted in production, using a key stored either in the
> RAILS_MASTER_KEY environment variable, or in a key file.

| CircleCI: Project Settings → `BUILD SETTINGS` (section) → `Environment Variables`
