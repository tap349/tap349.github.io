---
layout: post
title: rbenv
date: 2016-03-30 18:54:42 +0300
access: public
categories: [rbenv, ruby]
---

migration from RVM to rbenv.

<!-- more -->

- <https://github.com/rbenv/rbenv>
- <http://makandracards.com/makandra/21545-rbenv-how-to-switch-to-another-ruby-version-temporarily-per-project-or-globally>

- rbenv stores ruby versions in _~/.rbenv/versions_
- global (default) ruby version is stored in _~/.rbenv/version_
- rbenv uses ruby version from _.ruby-version_ if it's present

## installation

- install rbenv itself and current ruby:

  ```sh
  $ brew install rbenv
  $ rbenv init
  $ rbenv install 2.3.0
  $ rbenv global 2.3.0
  ```

- install bundler and global gems:

  ```sh
  $ gem install bundler git-up powder
  ```

- run `bundle` inside each project's directory

## usage

- `rbenv version` - show current ruby version
- `rbenv versions` - list all installed ruby versions
- `rbenv global 2.3.0` - set default ruby version for current user
- `rbenv shell system` - set ruby version for current shell only

## sourcing

_.zshrc_:

```sh
eval "$(rbenv init -)"
```

## bundle exec

- <http://bundler.io/man/bundle-exec.1.html>:

> bundle exec command executes the command, making all gems specified
> in the Gemfile(5) available to require in Ruby programs.

bundler is used to manage application dependencies (gemsets) -
RVM provides functionality to do it as well but bundler is a better way.
rbenv doesn't manage gemsets in contrast with RVM.

alias commands to be run with `bundle exec` in _.zshrc_:

```sh
alias guard='bundle exec guard'
alias rspec='bundle exec rspec'
```

## pow

<https://github.com/basecamp/pow/wiki/Troubleshooting#rbenv>

create _~/.powconfig_:

```sh
export PATH="$HOME/.rbenv/shims:/usr/local/opt/rbenv/bin:$PATH"
```

check where _bin_ is located - it's _/usr/local/opt/rbenv/bin_ if
rbenv was installed with `brew`.

don't forget to restart pow (or `kill -9` process better).

## command-t

switch to system ruby when compiling `command-t` vim plugin in _~.vim/update_bundles_:

```ruby
puts "compiling command-t..."

# https://langui.sh/2014/03/10/wunused-command-line-argument-hard-error-in-future-is-a-harsh-mistress
environment = 'ARCHFLAGS="-Wno-error=unused-command-line-argument-hard-error-in-future"'
command_t_path = File.join 'command-t', 'ruby', 'command-t'
rbenv_init_script = 'eval "$(rbenv init -)"'
command_t_build_script = 'rbenv shell system && ruby extconf.rb && make'

puts `zsh -c 'cd #{command_t_path} && #{rbenv_init_script} && #{environment} #{command_t_build_script}'`
```

## chef

RVM cannot be installed on debian 8 with `rvm` cookbook -
installing rbenv with `ruby_rbenv` cookbook went smoothly.

recipe:

```ruby
include_recipe 'ruby_build'
include_recipe 'ruby_rbenv::user'
```

attribute file:

```ruby
override['rbenv']['user_installs'] = [
  {
    'user' => 'deploy',
    'rubies' => ['2.3.0'],
    'global' => '2.3.0',
    'gems' => {
      '2.3.0' => [
        { 'name' => 'bundler' }
      ]
    }
  }
]
```

**NOTE**: `bundler` gem is not installed by default.
