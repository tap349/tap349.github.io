---
layout: post
title: npm - Tips
date: 2017-11-19 03:09:25 +0300
access: public
comments: true
categories: [yarn, npm, js]
---

<!-- more -->

* TOC
{:toc}
<hr>

(how to) install package globally
---------------------------------

### npm

```sh
$ npm install semistandard -g
/usr/local/bin/semistandard -> /usr/local/lib/node_modules/semistandard/bin/cmd.js
$ which semistandard
/usr/local/bin/semistandard
```

- global packages dir: _/usr/local/lib/node_modules/_

  ```sh
  $ npm root -g
  /usr/local/lib/node_modules/
  ```

### Yarn

```sh
$ yarn global add semistandard
$ which semistandard
/usr/local/bin/semistandard
```

- global packages dir: _~/.config/yarn/global/_
- global package.json: _~/.config/yarn/global/package.json_
- global _yarn.lock_: _~/.config/yarn/global/yarn.lock_

(how to) reinstall all packages
-------------------------------

```sh
$ rm -rf node_modules && npm install
```

[npm] (how to) remove not used packages
---------------------------------------

not used packages appear after removing packages from _package.json_ manually.

```sh
$ npm prune
```

dependencies vs. development dependencies
-----------------------------------------

install package as dependency:

```sh
$ npm install <package> --save
```

install package as development dependency:

```sh
$ npm install <package> --save-dev
```

dependencies:

- added to `dependencies` section of _package.json_
- application cannot run without it
- transitive dependencies are installed

  dependencies of your dependencies are installed recursively when you run
  `npm install`.

development dependencies:

- added to `devDependencies` section of _package.json_
- packages are used in development environment only (say, Babel or Flow)
- transitive development dependencies are not installed

  1. <https://stackoverflow.com/a/54157029/3632318>

  that is if you install some package `foo` and it has its own development
  dependencies, they are not installed when you run `npm install`.

(how to) run script or locally installed executable
---------------------------------------------------

`$(npm bin)` resolves to _node\_modules/.bin/_ - it can be used to run
executables from this directory directly.

- locally installed executables are stored in _node\_modules/.bin/_
  (= symlinks to JS executable files provided by npm packages)
- scripts are defined in `scripts` section of _package.json_
  (= usually invocations of these executables with custom arguments)

`yarn run` runs both of them:

```sh
$ yarn run <bin_or_script>
$ npm run <bin_or_script>
$ npm run-script <bin_or_script>
```

(how to) reset all (and clean cache)
------------------------------------

1. <https://gist.github.com/jarretmoses/c2e4786fd342b3444f3bc6beff32098d>

> message from `npm start`:
>
> 1. Clear watchman watches: `watchman watch-del-all`.
> 2. Delete the `node_modules` folder: `rm -rf node_modules && npm install`.
> 3. Reset Metro Bundler cache: `rm -rf $TMPDIR/react-*` or `npm start -- --reset-cache`.
> 4. Remove haste cache: `rm -rf $TMPDIR/haste-map-react-native-packager-*`.

```zsh
# _~/.zshenv_

alias npm_reset='\
  watchman watch-del-all &&
  rm -rf "$TMPDIR/react-native-packager-cache-*" &&
  rm -rf "$TMPDIR/metro-bundler-cache-*" &&
  rm -rf node_modules &&
  npm cache clean --force &&
  npm install
  '
```

```sh
$ npm_reset
$ npm start -- --reset-cache
```

it might be necessary to clean cache, say, when build fails. in many cases it's
enough just to reset cache - so try `npm start --reset-cache` command first.

(how to) update a package
-------------------------

- change package version in _package.json_
- `yarn upgrade <package>`

if Yarn/npm refuses to update a package (maybe it's a hack):

- change package version in _package.json_
- `yarn install`/`npm install`

use peer dependencies in npm packages only
------------------------------------------

1. <https://lexi-lambda.github.io/blog/2016/08/24/understanding-the-npm-dependency-model/>
2. <https://stackoverflow.com/a/34645112/3632318>

> <https://stackoverflow.com/a/34645112/3632318>
>
> peer dependencies tell npm: I need this package, but I need the version that
> is part of the project, not some version private to my module.

do I need to use peer dependencies if I am not npm package author?

say, _node_modules/react-native-push-notification/package.json_:

```json
"peerDependencies": {
  "react-native": ">=0.33"
},
```

so `react-native-push-notification` peer-depends on `react-native` - what would
happen if I use `react-native` of unsupported version:

1. as a depedency of my application?
2. as a peer dependency of my application?

- using `react-native` of unsupported version as a dependency

  _package.json_:

  ```json
  "dependencies": {
    "react-native": "0.30.0",
    "react-native-push-notification": "^3.0.0"
  },
  ```

  ```sh
  $ npm install
  ...
  npm WARN react-native-push-notification@3.0.1 requires a peer of react-native@>=0.33 but none was installed.
  ```

  => `react-native@0.30.0` is installed while a peer dependency of
  `react-native-push-notification` is not.

- using `react-native` of unsupported version as a peer dependency

  _package.json_:

  ```json
  "peerDependencies": {
    "react-native": "0.30.0"
  },
  "dependencies": {
    "react-native-push-notification": "^3.0.0"
  },
  ```

  ```sh
  $ npm install
  npm WARN my_app@0.0.1 requires a peer of react-native@0.30.0 but none was installed.
  npm WARN react-native-push-notification@3.0.1 requires a peer of react-native@>=0.33 but none was installed.
  ```

  => `react-native` is not installed - even if `react-native-push-notification`
  package is removed from the list of dependencies.

TL;DR:

don't use peer dependencies if you are not npm package author - they are not
automatically installed by npm (since version 3):

> peer dependencies are not automatically installed unless a dependent package
> explicitly depends on the peer package itself

so if you application depends on `react-native` package, add it to `depedencies`
along with its version.
