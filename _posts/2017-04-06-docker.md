---
layout: post
title: Docker
date: 2017-04-06 17:58:18 +0300
access: public
categories: [Docker]
---

first steps with Docker and troubleshooting.

<!-- more -->

## getting started

### docker-compose

- `docker-compose up -d`

  create and start containers listed in _.docker-compose.yml_
  (pull Docker images from Docker hub).

- `docker-compose ps`

  list containers (name, command, state, ports):

  ```
         Name                      Command               State           Ports
  -------------------------------------------------------------------------------------
  server_app_1          rackup -o 0.0.0.0 -p 4321        Up      0.0.0.0:4321->4321/tcp
  server_db_1           docker-entrypoint.sh postgres    Up      5432/tcp
  ```

  use `-a` option to show all containers (only running containers are shown by default):

  `docker ps -a`

- `docker-compose logs app`

  view output from all containers and from specified container.

  `app` above is a container name:

  - `app` in _.docker-compose.yml_
  - `server_app_1` in `docker-compose ps` output

  use `-f` option to follow log output (= `tail -f`):

  `docker-compose logs -f app`

  use `-t` option to show timestamps:

  `docker-compose logs -t app`

### docker

- `docker images`

  list images.

- `docker ps`

  list containers (container_id, image, command, created, status, ports, names):

  ```
  CONTAINER ID   IMAGE       COMMAND                  PORTS                    NAMES
  732******500   v***n/n**   "rackup -o 0.0.0.0..."   0.0.0.0:4321->4321/tcp   server_app_1
  e0e******c7c   postgres    "docker-entrypoint..."   5432/tcp                 server_db_1
  ```

  note that `CREATED` and `STATUS` columns have been removed from output for
  the sake of readability.

- `docker logs server_app_1`

  same as `docker-compose logs app` but use container name as specified in
  `docker ps` or `docker-compose ps` output.

- `docker build -t v***n/n** ./`

  build image from Dockerfile (the latter must be present in CWD).
  it's necessary to rebuild the whole image when you make any changes that
  must be persisted (for `app` container: when you modify ruby source code).

## troubleshooting

### `Cannot connect to the Docker daemon. Is the docker daemon running on this host?`

just install Docker app via `brew cask`.
it's possible to install all the necessary docker tools (`boot2docker`,
`docker`, `docker-compose`, etc.) manually but I didn't manage to configure
them all in reasonable time. so it's better to install Docker app - it does
all the heavy lifting for you.

`$ brew cask install docker`

don't forget to run Docker app after installation
(otherwise `docker` command might be not available in terminal).
