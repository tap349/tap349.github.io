---
layout: post
title: Vim
date: 2016-12-11 16:35:17 +0300
access: public
comments: true
categories: [vim]
---

<!-- more -->

* TOC
{:toc}
<hr>

tips
----

### interactive history of commands

`q:`

- opens command-editing window with history of commands
- commands can be edited in-place and run with `<C-CR>`
- can also be opened with `<C-f>` when typing ex command
  (can be useful to type/edit complex commands)

### global command

`:g`

<http://disq.us/p/dkhy28>:

> The global command is actually the origin of grep's name - :g/re/p would
> print out all lines matching the regular expression "re".

delete all lines containing a pattern:

`:g/foo/d`

### make all tab windows equally high and wide

- `<C-w>=`
- `:help window-resize`

### local functions and their usage in autocommands and mappings

1. <http://vim.1045645.n5.nabble.com/lt-SID-gt-or-s-General-questions-about-functions-td4297515.html#a4298658>
2. `help :local-function`

say, we have a local function (a function local to a script, starts with `s:`):

```vim
function! s:GoToPrevTab()
  ...
endfunction
```

inside autocommands it can be called as is:

```vim
augroup tabs
  autocmd!
  autocmd TabEnter * call s:GoToPrevTab()
augroup END
```

but inside mappings you must prefix its name with `<SID>` (instead of `s:`):

```vim
nnoremap <C-Tab> :call <SID>GoToPrevTab()<CR>
```

### call vs. exec (execute)

1. <http://stackoverflow.com/questions/18178768/vimscript-call-vs-execute>

- `call` - used to call function: `call s:GoToPrevTab()`
- `exec` - used to evaluate string: `exec 'tabnext ' . g:lasttabnr`

### check current mode in vimscript

```vim
function! SetDiffMode()
  if &diff
    " ...
  endif
endfunction
```

### count number of matches of a pattern

1. <http://vim.wikia.com/wiki/Count_number_of_matches_of_a_pattern>

count matches:

```vim
:%s/pattern//gn
```

count lines with matches:

```vim
:%s/pattern//n
```

### filetype-specific settings

filetype-specific settings can be set in 2 ways:

- in _~/.vim/vimrc_ (or any Vim file sourced from it)

  _~/.vim/autocommands.vim_:

  ```vim
  augroup filetypes
    autocmd!
    autocmd FileType qf setlocal colorcolumn= cursorline nonumber scrolloff=0
  augroup END
  ```

- in _~/.vim/ftplugin/\<filetype>.vim_

  _~/.vim/ftplugin/qf.vim_:

  ```vim
  setlocal colorcolumn=
  setlocal cursorline
  setlocal nonumber
  setlocal scrolloff=0
  ```

### repeat previous search in history

```vim
//
```

### paste the word under cursor to command line

`<C-r><C-w>`

### tweak colorscheme for specific filetype

1. <https://robots.thoughtbot.com/writing-vim-syntax-plugins#syntax>
2. <https://stackoverflow.com/a/15702132/3632318>
3. `:help syn-match`

say, I want to use different foreground color for Elixir typespecs.

create _~/.vim/syntax/elixir.vim_ to override current colorscheme
settings:

```vim
hi Typespec guifg=#A0A0B0 gui=italic
syn match Typespec /^\s*@spec.*$/
```

`syn match` command wouldn't work in _~/vim/after/ftplugin/elixir.vim_
for some reason.

### get relative path of current file

1. <https://stackoverflow.com/a/24463362/3632318>

> <https://stackoverflow.com/a/24463362/3632318>
>
> Although expand('%') often works, there are rare occasions where it does not.

show current file path relative to PWD or path relative to home directory if
current file is not in PWD:

```vim
:echo fnamemodify(expand('%'), ':~:.')
```

or else it's possible to show absolute path if current file is not in PWD:

```vim
:echo fnamemodify(expand('%'), ':.')
```

debugging
---------

1. <https://github.com/c9s/vim-dev-plugin>

### current mapping of any key or key combination

- `:verbose map <S-CR>`
- `:verbose nmap ,f`

### current option value

for `path` option:

- `:set path?`
- `echo &path`

### all autocommands currently associated with augroup

```vim
:autocmd <augroup_name>
```

it might be useful to check there are no duplicate autocommands.

### Vim profiling

1. <https://www.reddit.com/r/vim/comments/2lw1fd/pretty_statuslines_vs_cursor_speed/cm18qgt/>:

> 1. Execute `:profile start result | profile func *`
> 2. Do some stuff (moving cursor around or splitting windows)
> 3. Quit Vim
> 4. Open result file and go to the last part of the log, see what's causing your editor heavy.

### print messages about what Vim is doing

1. <https://superuser.com/a/747405/326775>
2. `:help 'verbose'`

say, to print every executed autocommand:

```vim
:set verbose=9
```

to print everything:

```vim
:set verbose=15
```

it's possible to set `verbose` level and run a command in one
go in order to understand what's going on when command is run.

e.g., setting `verbose` level right before opening a file can
be used to find out the reason why syntax highlighting is lost:

```vim
:set verbose=15 | edit foo.js
```

### print debugging messages

when debugging a plugin, messages printed inside the plugin with
`echom[sg]` are not saved in message history (`:messages`) - use
`echoe[rr]` instead.
