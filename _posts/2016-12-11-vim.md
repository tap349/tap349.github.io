---

layout: post
title: Vim
date: 2016-12-11 16:35:17 +0300
access: public
categories: [vim]
---

<!-- more -->

* TOC
{:toc}
<hr>

## tips

### interactive history of commands

`q:`

- opens command-editing window with history of commands
- commands can be edited in-place and run with `<C-CR>`
- can also be opened with `<C-f>` when typing ex command
  (can be useful to type/edit complex commands)

### global command

`:g`

<http://disq.us/p/dkhy28>:

> The global command is actually the origin of grep's name - :g/re/p would
> print out all lines matching the regular expression "re".

### make all windows within tab equally high and wide

- `<C-w>=`
- `:help window-resize`

### local functions and their usage in autocommands and mappings

- <http://vim.1045645.n5.nabble.com/lt-SID-gt-or-s-General-questions-about-functions-td4297515.html#a4298658>
- `help :local-function`

say, we have a local function (a function local to a script, starts with `s:`):

```vim
function! s:GoToPrevTab()
  ...
endfunction
```

inside autocommands it can be called as is:

```vim
augroup tabs
  autocmd!
  autocmd TabEnter * call s:GoToPrevTab()
augroup END
```

but inside mappings you must prefix its name with `<SID>` (instead of `s:`):

```vim
nnoremap <C-Tab> :call <SID>GoToPrevTab()<CR>
```

### call vs. exec (execute)

- <http://stackoverflow.com/questions/18178768/vimscript-call-vs-execute>

- `call` - used to call function: `call s:GoToPrevTab()`
- `exec` - used to evaluate string: `exec 'tabnext ' . g:lasttabnr`

### check current mode in vimscript

```vim
function! SetDiffMode()
  if &diff
    " ...
  endif
endfunction
```

### count number of matches of a pattern

<http://vim.wikia.com/wiki/Count_number_of_matches_of_a_pattern>

count matches:

```vim
:%s/pattern//gn
```

count lines with matches:

```vim
:%s/pattern//n
```

### filetype-specific settings

filetype-specific settings can be set in 2 ways:

- in _~/.vim/vimrc_ (or any Vim file sourced from it)

  _~/.vim/autocommands.vim_:

  ```vim
  augroup filetypes
    autocmd!
    autocmd FileType qf setlocal colorcolumn= cursorline nonumber scrolloff=0
  augroup END
  ```

- in _~/.vim/ftplugin/\<filetype>.vim_

  _~/.vim/ftplugin/qf.vim_:

  ```vim
  setlocal colorcolumn=
  setlocal cursorline
  setlocal nonumber
  setlocal scrolloff=0
  ```

## debugging

### current mapping of any key or key combination

- `:verbose map <S-CR>`
- `:verbose nmap ,f`

### current option value

for `path` option:

- `:set path?`

### current autocmds

list all autocommands currently associated with specified group:

```vim
:autocmd <augroup_name>
```

it might be useful to check there are no duplicate autocommands.

### Vim profiling

<https://www.reddit.com/r/vim/comments/2lw1fd/pretty_statuslines_vs_cursor_speed/cm18qgt/>:

> 1. Execute `:profile start result | profile func *`
> 2. Do some stuff (moving cursor around or splitting windows)
> 3. Quit Vim
> 4. Open result file and go to the last part of the log, see what's causing your editor heavy.

### capture sequence of commands

<https://superuser.com/a/747405/326775>

```vim
:set verbose=20 | edit a.js
```

## troubleshooting

### syntastic

in my case problem was with invalid _.rubocop.yml_ file. this can be easily
checked by running `rubocop` in project root: if rubocop starts analyzing your
project then all is fine otherwise it complains about invalid syntax -
in that case just follow on-screen instructions and fix _.rubocop.yml_.

to debug inside Vim turn on syntastic debugging messages in command-line mode:

```vim
:let g:syntastic_debug = 1 " or 3 or 33
```

run syntastic checkers:

```vim
:SyntasticCheck mri rubocop
```

view syntastic debugging messages in Vim messages:

```vim
:messages
```

in my case rubocop returned status code 2 which means running rubocop checker
failed on rubocop side.

BTW always set path to ruby and rubocop executables manually so as not to
rely on correct `PATH` inside Vim (it can be messed up for a million reasons):

```vim
let g:syntastic_ruby_mri_exec = '~/.rbenv/shims/ruby'
let g:syntastic_ruby_rubocop_exec = '~/.rbenv/shims/rubocop'
```
