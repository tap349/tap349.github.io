---
layout: post
title: dry-rb
date: 2016-08-26 12:36:10 +0300
access: public
categories: [dry-rb, rspec]
---

dry-rb related notes.

<!-- more -->

### container stubs

- example usage: <https://github.com/dry-rb/dry-container/pull/11#issuecomment-184765175>
- source: <https://github.com/dry-rb/dry-container/blob/master/lib/dry/container/stub.rb>

enable container stubs in test environment only and do it before
finalizing container since the latter freezes its own class and you
cannot extend it with `Dry::Container::Stub`.

_config/environment.rb_:

```ruby
# Load and finalize DI container
require_relative '../system/reenter_builder/container'

# Enable container stubs in test environment
# (do it before finalize! since the latter freezes container class)
if Rails.env.test?
  require 'dry/container/stub'
  ReenterBuilder::Container.enable_stubs!
end

ReenterBuilder::Container.finalize! unless Rails.env.test?
```

the problem in controller specs is that you cannot stub specific container
entry in before block because by this time controller object will have already
been instantiated and injected with real objects.
