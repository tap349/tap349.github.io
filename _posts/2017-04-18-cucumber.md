---
layout: post
title: Cucumber
date: 2017-04-18 13:17:39 +0300
access: public
categories: [cucumber]
---

<!-- more -->

_Rakefile_:

```ruby
require 'cucumber/rake/task'

desc 'Run acceptance tests'
Cucumber::Rake::Task.new(:features) do |task|
  # default options are set in cucumber.yml
  task.fork = false
end
```

_config/cucumber.yml_:

```yaml
<% common_options = '--format pretty' %>

default: <%= common_options %> features
```

to enable syntax highlighting for feature files in vim
it's not required to install `tpope/vim-cucumber` plugin.

## aruba

_features/support/aruba.rb_:

```ruby
require 'aruba/cucumber'
```

that's all that is required to use aruba steps in your features.

by default aruba working directory is _tmp/aruba/_
(this is where all temporary files are created).

mock home directory (set HOME environment variable to aruba working directory):
<https://relishapp.com/philoserf/aruba/docs/environment/mock-the-home-variable>.

## troubleshooting

### syntastic doesn't find aruba step definitions

- https://github.com/tpope/vim-cucumber/issues/30
- http://fasteragile.com/blog/2015/05/15/highlighting-undefined-cucumber-step-definitions-with-syntastic-in-vim/

#### description

it's necessary to require `aruba/cucumber` so that syntastic could find
aruba step definitions. this file is required in _features/support/env.rb_
as recommended in aruba documentation. but syntastic kept on showing
`Cucumber::Undefined` errors for all aruba steps.

#### solution

I edited _~/.vim/vimrc_ to run cucumber with syntastic profile:

```vim
let g:syntastic_cucumber_cucumber_args='--profile syntastic'
```

and required _features/support_ directory explicitly for syntastic profile
in _config/cucumber.yml_:

```yaml
<% common_options = '--format pretty' %>

default: <%= common_options %> features
syntastic: -r features/support <%= common_options %> features
```

but that didn't help.

in the end it turned out the problem was with the name of support file -
syntastic refused to find exactly _features/support/env.rb_.

btw `aruba init --test-framework cucumber` generates _features/support/aruba.rb_
so I renamed _env.rb_ to _aruba.rb_ too. after that syntastic no longer showed
errors for aruba steps - only for not implemented ones. moreover filename doesn't
even matter - it can be anything but _env.rb_.

long story short:

syntastic doesn't require _features/support/env.rb_ for some reason -
just rename it to something else (say, _aruba.rb_). no modifications to
_config/cucumber.yml_ or _~/.vim/vimrc_ are necessary.
