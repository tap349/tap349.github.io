---
layout: post
title: SQL - Tips
date: 2017-11-28 10:33:54 +0300
access: public
comments: true
categories: [sql]
---

<!-- more -->

* TOC
{:toc}
<hr>

(how to) specify condition in COUNT
-----------------------------------

```sql
SELECT COUNT(CASE WHEN is_admin IS TRUE THEN 1 END) AS admin_count FROM users;
SELECT COUNT(CASE WHEN is_admin IS TRUE THEN 1 ELSE NULL END) AS admin_count FROM users;
```

NOTE: don't specify `ELSE 0` in condition - all rows will be counted then!

(how to) count occurrences of specific element in array column
-----------------------------------------------------------------

1. <https://stackoverflow.com/a/26524451/3632318>

count occurrences of player id 2503 in all rows:

```sql
=# select * from game_stats;

 id | game_id |     player_ids    |
----+---------+-------------------+
  1 |   17233 |  {}               |
  2 |   17235 |  {}               |
  3 |   17210 |  {2503}           |
  4 |   17213 |  {2502,2503,2503} |
```

```sql
SELECT COUNT(*) AS player_count
FROM (
  SELECT
    game_stats.game_id AS game_id,
    unnest(game_stats.player_ids) AS player_id
  FROM game_stats
) unnested_game_stats
WHERE unnested_game_stats.player_id = 2503
```
